<!-- Generated by SpecStory, Markdown v2.0.0 -->

<!-- vscode Session dbca0a9e-5004-4895-b0b4-5dde77182630 (2025-11-09 20:36Z) -->

# Jest-Axe configuration error with tags property (2025-11-09 20:36Z)

_**User (2025-11-09 20:38Z)**_

@workspace /explain Object literal may only specify known properties, and 'tags' does not exist in type 'JestAxeConfigureOptions'.

---

_**Agent (model copilot/claude-sonnet-4.5)**_

The error indicates that `configureAxe` from `jest-axe` doesn't accept a `tags` property. Let me explain the issue and provide a fix.

## The Problem

The `configureAxe` function from `jest-axe` has a more limited configuration interface than axe-core itself. The `tags` option is used directly in axe-core's `run()` method, not in the configuration.

## The Solution

You have two approaches:

### Option 1: Move `tags` to Runtime (Recommended)

Remove `tags` from configuration and pass it when running axe:

````typescript
/**
 * Accessibility testing helpers using axe-core
 * Provides utilities for automated WCAG 2.1 AA compliance testing
 */

import { configureAxe } from 'jest-axe';
import type { AxeResults, ElementContext, RunOptions } from 'axe-core';

/**
 * Configured axe instance for WCAG 2.1 AA compliance
 */
export const axe = configureAxe({
  rules: {
    // WCAG 2.1 AA rules
    'color-contrast': { enabled: true },
    'keyboard-navigation': { enabled: true },
    'focus-management': { enabled: true },
    'aria-labels': { enabled: true },
    'landmark-roles': { enabled: true },
    'heading-order': { enabled: true },
    'alt-text': { enabled: true },
    'form-labels': { enabled: true },
  },
});

/**
 * Default axe options for WCAG 2.1 AA testing
 */
const defaultAxeOptions: RunOptions = {
  runOnly: {
    type: 'tag',
    values: ['wcag2a', 'wcag2aa', 'wcag21aa'],
  },
};

/**
 * Assert that an element has no accessibility violations
 * @param element - DOM element or document to test
 * @param options - Additional axe options
 */
export async function assertA11y(
  element: Element | Document = document,
  options?: RunOptions
): Promise<void> {
  const mergedOptions = { ...defaultAxeOptions, ...options };
  const results = await axe(element, mergedOptions);
  expect(results).toHaveNoViolations();
}

/**
 * Get detailed accessibility results without throwing
 * @param element - DOM element or document to test
 * @param options - Additional axe options
 * @returns Promise resolving to axe results
 */
export async function getA11yResults(
  element: Element | Document = document,
  options?: RunOptions
): Promise<AxeResults> {
  const mergedOptions = { ...defaultAxeOptions, ...options };
  return await axe(element, mergedOptions);
}
````

### Option 2: Use axe-core Directly

If you need more control, bypass `jest-axe` and use axe-core directly:

````typescript
import { run as runAxe } from 'axe-core';
import type { AxeResults, RunOptions, Spec } from 'axe-core';
import { toHaveNoViolations } from 'jest-axe';

// Extend Jest matchers
expect.extend(toHaveNoViolations);

const axeConfig: Spec = {
  rules: {
    'color-contrast': { enabled: true },
    // ...other rules
  },
};

export async function assertA11y(
  element: Element | Document = document,
  options?: RunOptions
): Promise<void> {
  const results = await runAxe(element, {
    ...options,
    runOnly: {
      type: 'tag',
      values: ['wcag2a', 'wcag2aa', 'wcag21aa'],
    },
  });
  expect(results).toHaveNoViolations();
}
````

## Key Points

- **`tags`** is a runtime option, not a configuration option
- Use **`runOnly`** to specify which tags to test against
- The configured rules still apply alongside the tag-based rules
- Option 1 is cleaner if you want to stick with `jest-axe`'s wrapper

---

_**User (2025-11-09 20:40Z)**_

@workspace /explain Argument of type 'Element | Document' is not assignable to parameter of type 'string | Element'.
  Type 'Document' is not assignable to type 'string | Element'.
    Type 'Document' is missing the following properties from type 'Element': attributes, classList, className, clientHeight, and 116 more.

---

_**Agent (model copilot/claude-sonnet-4.5)**_

The issue is that `jest-axe`'s `configureAxe` returns a function that accepts `Element` but not `Document`. Let's fix the type signature:

````typescript
/**
 * Accessibility testing helpers using axe-core
 * Provides utilities for automated WCAG 2.1 AA compliance testing
 */

import { configureAxe } from 'jest-axe';
import type { AxeResults, RunOptions } from 'axe-core';

/**
 * Configured axe instance for WCAG 2.1 AA compliance
 */
export const axe = configureAxe({
  rules: {
    // WCAG 2.1 AA rules
    'color-contrast': { enabled: true },
    'keyboard-navigation': { enabled: true },
    'focus-management': { enabled: true },
    'aria-labels': { enabled: true },
    'landmark-roles': { enabled: true },
    'heading-order': { enabled: true },
    'alt-text': { enabled: true },
    'form-labels': { enabled: true },
  },
});

/**
 * Default axe options for WCAG 2.1 AA testing
 */
const defaultAxeOptions: RunOptions = {
  runOnly: {
    type: 'tag',
    values: ['wcag2a', 'wcag2aa', 'wcag21aa'],
  },
};

/**
 * Assert that an element has no accessibility violations
 * @param element - DOM element to test (defaults to document.body)
 * @param options - Additional axe options
 */
export async function assertA11y(
  element: Element = document.body,
  options?: RunOptions
): Promise<void> {
  const mergedOptions = { ...defaultAxeOptions, ...options };
  const results = await axe(element, mergedOptions);
  expect(results).toHaveNoViolations();
}

/**
 * Get detailed accessibility results without throwing
 * @param element - DOM element to test (defaults to document.body)
 * @param options - Additional axe options
 * @returns Promise resolving to axe results
 */
export async function getA11yResults(
  element: Element = document.body,
  options?: RunOptions
): Promise<AxeResults> {
  const mergedOptions = { ...defaultAxeOptions, ...options };
  return await axe(element, mergedOptions);
}
````

## Key Changes

1. **Changed default parameter** from `document` to `document.body`
   - `document.body` is an `Element`, which jest-axe expects
   - This is the typical use case for a11y testing anyway

2. **Updated type signatures** to only accept `Element`
   - Removed `| Document` from the union type
   - Aligns with jest-axe's actual implementation

3. **Updated JSDoc comments** to reflect the change

## Why This Works

- `document.body` covers the entire page content (which is what you typically want to test)
- It's an actual `Element` that satisfies jest-axe's type requirements
- Users can still pass specific elements to test focused areas

---

_**User (2025-11-09 20:41Z)**_

@workspace /explain Argument of type '{ runOnly?: axe.RunOnly | axe.TagValue[] | string[] | string; rules?: axe.RuleObject; reporter?: axe.ReporterVersion | string; ... 10 more ...; pingWaitTime?: number; }' is not assignable to parameter of type 'RunOptions'.
  Types of property 'runOnly' are incompatible.
    Type 'string | RunOnly | string[] | undefined' is not assignable to type 'string[] | RunOnly | TagValue[] | undefined'.
      Type 'string' is not assignable to type 'string[] | RunOnly | TagValue[] | undefined'.

---

_**Agent (model copilot/claude-sonnet-4.5)**_

The issue is that `jest-axe`'s type definitions are slightly different from `axe-core`'s. Let's use the correct types from `jest-axe`:

````typescript
/**
 * Accessibility testing helpers using axe-core
 * Provides utilities for automated WCAG 2.1 AA compliance testing
 */

import { configureAxe, type JestAxeConfigureOptions } from 'jest-axe';
import type { AxeResults, RunOptions } from 'axe-core';

/**
 * Configured axe instance for WCAG 2.1 AA compliance
 */
export const axe = configureAxe({
  rules: {
    // WCAG 2.1 AA rules
    'color-contrast': { enabled: true },
    'keyboard-navigation': { enabled: true },
    'focus-management': { enabled: true },
    'aria-labels': { enabled: true },
    'landmark-roles': { enabled: true },
    'heading-order': { enabled: true },
    'alt-text': { enabled: true },
    'form-labels': { enabled: true },
  },
} satisfies JestAxeConfigureOptions);

/**
 * Default axe options for WCAG 2.1 AA testing
 */
const defaultAxeOptions = {
  runOnly: {
    type: 'tag' as const,
    values: ['wcag2a', 'wcag2aa', 'wcag21aa'],
  },
};

/**
 * Assert that an element has no accessibility violations
 * @param element - DOM element to test (defaults to document.body)
 * @param options - Additional axe options
 */
export async function assertA11y(
  element: Element = document.body,
  options?: RunOptions
): Promise<void> {
  const mergedOptions = { ...defaultAxeOptions, ...options };
  const results = await axe(element, mergedOptions);
  expect(results).toHaveNoViolations();
}

/**
 * Get detailed accessibility results without throwing
 * @param element - DOM element to test (defaults to document.body)
 * @param options - Additional axe options
 * @returns Promise resolving to axe results
 */
export async function getA11yResults(
  element: Element = document.body,
  options?: RunOptions
): Promise<AxeResults> {
  const mergedOptions = { ...defaultAxeOptions, ...options };
  return await axe(element, mergedOptions);
}
````

## Key Changes

1. **Added `as const` to `type: 'tag'`** - This ensures TypeScript treats it as the literal type `'tag'` instead of the wider `string` type
2. **Removed explicit `RunOptions` type** from `defaultAxeOptions` - Let TypeScript infer the correct type
3. **Added `satisfies JestAxeConfigureOptions`** to the axe configuration for better type checking

The issue was that TypeScript was widening the string literal `'tag'` to the general `string` type, which doesn't match the expected union type. Using `as const` preserves the literal type.

---

_**User (2025-11-09 20:43Z)**_

@workspace /explain Argument of type '{ runOnly: axe.RunOnly | axe.TagValue[] | string[] | string; rules?: axe.RuleObject; reporter?: axe.ReporterVersion | string; ... 10 more ...; pingWaitTime?: number; }' is not assignable to parameter of type 'RunOptions'.
  Types of property 'runOnly' are incompatible.
    Type 'string | string[] | RunOnly' is not assignable to type 'string[] | RunOnly | TagValue[] | undefined'.
      Type 'string' is not assignable to type 'string[] | RunOnly | TagValue[] | undefined'.

---

_**Agent (model copilot/claude-sonnet-4.5)**_

The issue is that spreading `defaultAxeOptions` into the merged options is causing type widening. Let's fix this by being more explicit with the types:

````typescript
/**
 * Accessibility testing helpers using axe-core
 * Provides utilities for automated WCAG 2.1 AA compliance testing
 */

import { configureAxe, type JestAxeConfigureOptions } from 'jest-axe';
import type { AxeResults, RunOptions } from 'axe-core';

/**
 * Configured axe instance for WCAG 2.1 AA compliance
 */
export const axe = configureAxe({
  rules: {
    // WCAG 2.1 AA rules
    'color-contrast': { enabled: true },
    'keyboard-navigation': { enabled: true },
    'focus-management': { enabled: true },
    'aria-labels': { enabled: true },
    'landmark-roles': { enabled: true },
    'heading-order': { enabled: true },
    'alt-text': { enabled: true },
    'form-labels': { enabled: true },
  },
} satisfies JestAxeConfigureOptions);

/**
 * Default axe options for WCAG 2.1 AA testing
 */
const defaultAxeOptions = {
  runOnly: {
    type: 'tag' as const,
    values: ['wcag2a', 'wcag2aa', 'wcag21aa'],
  },
} as const;

/**
 * Assert that an element has no accessibility violations
 * @param element - DOM element to test (defaults to document.body)
 * @param options - Additional axe options
 */
export async function assertA11y(
  element: Element = document.body,
  options?: RunOptions,
): Promise<void> {
  const mergedOptions: RunOptions = {
    ...defaultAxeOptions,
    ...options,
  };
  const results = await axe(element, mergedOptions);
  expect(results).toHaveNoViolations();
}

/**
 * Get detailed accessibility results without throwing
 * @param element - DOM element to test (defaults to document.body)
 * @param options - Additional axe options
 * @returns Promise resolving to axe results
 */
export async function getA11yResults(
  element: Element = document.body,
  options?: RunOptions,
): Promise<AxeResults> {
  const mergedOptions: RunOptions = {
    ...defaultAxeOptions,
    ...options,
  };
  return await axe(element, mergedOptions);
}
````

## Key Changes

1. **Added `as const` to `defaultAxeOptions`** - Makes the entire object deeply readonly with literal types
2. **Added explicit `RunOptions` type annotation** to `mergedOptions` - This tells TypeScript to treat the merged object as `RunOptions`, satisfying the type checker

The combination of `as const` on the default options and the explicit type annotation on the merged result ensures TypeScript understands the types correctly.

---

_**User (2025-11-09 20:44Z)**_

/clear 

---

_**Agent**_



---

